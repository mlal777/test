function myFunction() {
    var e = document.getElementById("myDIV");
    "block" === e.style.display ? e.style.display = "none" : e.style.display = "block"
}

function changeBG(e, t, s, o, l, n, d) {
    console.log("called changeBG method");
    e = document.getElementById(e), t = document.getElementById(t), s = document.getElementById(s), o = document.getElementById(o), l = document.getElementById(l), n = document.getElementById(n), e.style.background = "#fff", e.style.boxShadow = "box-shadow: 0px 14px 24px rgba(0, 0, 0, 0.07)", t.style.background = "transparent", t.style.boxShadow = "none", s.style.display = d, o.style.display = d, l.style.display = d, n.style.display = d
}

function Show(e, t, s) {
    console.log("Called show method");
    (e = document.getElementById(e)).style.display = "block", (t = document.getElementById(t)).style.display = "block", (s = document.getElementById(s)).style.display = "none"
}

function Hide(e, t, s) {
    (e = document.getElementById(e)).style.display = "None", (t = document.getElementById(t)).style.display = "block", (s = document.getElementById(s)).style.display = "none"
}! function(t) {
    "use strict";
    t(".komb-slider").slick({
        dots: !0,
        infinite: !1,
        speed: 800,
        slidesToShow: 1,
        variableWidth: !0,
        swipeToSlide: !0,
        prevArrow: t(".btn-carousel-prev"),
        nextArrow: t(".btn-carousel-next")
    }), t(".komb-slider-2").slick({
        dots: !0,
        infinite: !1,
        speed: 800,
        slidesToShow: 1,
        variableWidth: !0,
        swipeToSlide: !0,
        prevArrow: t(".btn-carousel-prev-2"),
        nextArrow: t(".btn-carousel-next-2")
    }), t(".komb-slider-3").slick({
        dots: !0,
        infinite: !1,
        speed: 800,
        slidesToShow: 1,
        variableWidth: !0,
        swipeToSlide: !0,
        prevArrow: t(".btn-carousel-prev-3"),
        nextArrow: t(".btn-carousel-next-3")
    }), t(".komb-slider-4").slick({
        dots: !0,
        infinite: !1,
        speed: 800,
        slidesToShow: 1,
        variableWidth: !0,
        swipeToSlide: !0,
        prevArrow: t(".btn-carousel-prev-4"),
        nextArrow: t(".btn-carousel-next-4")
    }), t(".komb-slider-5").slick({
        dots: !0,
        infinite: !1,
        speed: 800,
        slidesToShow: 1,
        variableWidth: !0,
        swipeToSlide: !0,
        prevArrow: t(".btn-carousel-prev-5"),
        nextArrow: t(".btn-carousel-next-5")
    }), t(".mobile-menu").on("click", function() {
        t(this).closest(".header-button");
        var e = t(this).closest(".header-menu");
        e.hasClass("open") ? (t(this).closest(".app").removeClass("fixed"), e.removeClass("open"), t(this).removeClass("mobile")) : (t(this).closest(".app").addClass("fixed"), e.addClass("open"), t(this).addClass("mobile")), t(".product-filter").removeClass("open"), t("body").find(".overlay-product").remove(), t("body").removeClass("stuck-mobile")
    })
}(jQuery);

$(document).ready(function () {
    $("body").on('click', '#collapse', function() {
        console.log("Clicked collapse function");
        changeBG('collapse', 'expand', 'Show', 'Showt', 'Showth', 'Showf', 'none');
    });
    $("body").on('click', '#expand', function() {
        console.log("Clicked expand function");
        changeBG('expand', 'collapse', 'Show', 'Showt', 'Showth', 'Showf', 'block');
    });

    $("body").on('click', '#More', function() {
        console.log("Clicked function");
         Show('Show', 'Less', 'More');
    });
    $("body").on('click', '#Less', function() {
         console.log("Clicked function");
        Hide('Show', 'More', 'Less');
    });

    $("body").on('click', '#Moret', function() {
        console.log("Clicked function");
        Show('Showt', 'Lesst', 'Moret');
    });
    $("body").on('click', '#Lesst', function() {
        console.log("Clicked function");
        Hide('Showt', 'Moret', 'Lesst');
    });

    $("body").on('click', '#Moreth', function() {
        console.log("Clicked function");
        Show('Showth', 'Lessth', 'Moreth');
    });
    $("body").on('click', '#Lessth', function() {
        console.log("Clicked function");
        Hide('Showthf', 'Moreth', 'Lessth');
    });

    $("body").on('click', '#Moref', function() {
        console.log("Clicked function");
        Show('Showf', 'Lessf', 'Moref');
    });
    $("body").on('click', '#Lessf', function() {
        console.log("Clicked function");
         Hide('Showf', 'Moref', 'Lessf');
    });

    $("body").on('click', '#url-btn-0', function() {
        console.log("Clicked function");
        var url = $("#url-0").text();
         window.open(url,'_blank');
    });

    $("body").on('click', '#url-btn-1', function() {
        console.log("Clicked function");
        var url = $("#url-1").text();
         window.open(url,'_blank');
    });

    $("body").on('click', '#url-btn-2', function() {
        console.log("Clicked function");
        var url = $("#url-2").text();
         window.open(url,'_blank');
    });

    $("body").on('click', '#url-btn-3', function() {
        console.log("Clicked function");
        var url = $("#url-3").text();
        window.open(url,'_blank');
    });  

    $(".compareForm").submit(function(event) {
        event.preventDefault();
        $.ajax({
            url: "/compare",
            type: "GET",
            dataType: "JSON",
            data: {
                product_url: $(".inputClass").val(),
            },
            success: function(data) {
                if (window.location.href.indexOf("/result.html") < 0) {
                    window.location.href = "./result.html";
                }
                if (data.amazonProducts == null || data.amazonProducts.length == 0) {
                    $("#result-container").html("Sorry, we don't have anything for this product yet.");
                } else {
                    // Clear the pre-coded results and populate it with results from server
                    $( "#result-container" ).empty();

                    var $resultResult = $("<div class='result-result'></div>");
                    $( "#result-container" ).append($resultResult);

                    
                    var products = data.amazonProducts;
                    var maxMentions = 6;
                    for (var i=0; i < products.length; i++) {
                        console.log(" result item number " + i);
                        var $resultRecommendation;
                        var product = products[i];
                        var resultId = "result-" + i;
                        var recommendationDivId = "#" + resultId;
                        console.log("I made this change yo");

                        if (i == 0) {
                            $resultRecommendation = $("<div id='" + resultId + "' class='result-result-card'></div>");
                            
                            // Add result item to results page.
                            var $buttonDiv = $("<div id='collapse-btn' class='button'></div>");
                            $( ".result-result" ).append($buttonDiv);
                            
                            var $button1 = $("<button id='collapse'>Collapse All </button>");
                            var $button2 = $("<button id='expand'>Expand All</button>");
                            //var $button1 = $("<button onclick='changeBG(\'collapse\', \'expand\', \'Show\', \'Showt\', \'Showth\', \'Showf\', \'none\')' id='collapse'>Collapse All </button>");
                            //var $button2 = $("<button onclick='changeBG(\'expand\', \'collapse\', \'Show\', \'Showt\', \'Showth\', \'Showf\', \'block\')' id='expand'>Expand All</button>");
                            $( "#collapse-btn").append($button1, $button2);
                            $( ".result-result" ).append($resultRecommendation);
                        } else {
                            $resultRecommendation = $("<div id='" + resultId + "' class='result-recommendation-card'></div>");

                            // Add result item to results page
                            $( ".result-recommendation" ).append($resultRecommendation);
                        }

                        var $yourPick;
                        if (i == 0) {

                            $yourPick = $( "<div class='your-pick'><img src='./assets/images/your-pick.png' alt='Cartaygo'></div>");
                            $( ".result-result-card" ).append($yourPick);                            
                        }

                        if (i == 1) {
                            // Add Recommendation header if there are recommendations
                            $( ".result-recommendation" ).append("<div class='result-result'><h1 class='text'>Recommendation For You</h1></div>");

                            $yourPick = $( "<div class='your-pick'><img src='./assets/images/our-pick.png' alt='Cartaygo'></div>");
                            $(recommendationDivId).append($yourPick);
                        }

                        // Image carousal                            
                        var btnCursorUniqueId = "btn-cursor-" + i;
                        var btnCursorDivId = "#" + btnCursorUniqueId;
                        var $buttonCursor = $( "<div id='" + btnCursorUniqueId + "' class='button-cursor'></div>" );
                        $(recommendationDivId).append($buttonCursor);


                        var $leftButton = $("<button class='btn-carousel-prev-" + (i+2) + "'> <img src='./assets/images/left-angle.png' alt='Cartaygo'></button>");
                        var $rightButton = $("<button class='btn-carousel-next-" + (i+2) + "'> <img src='./assets/images/right-angle.png' alt='Cartaygo'></button>");
                        $(btnCursorDivId).append($leftButton, $rightButton);


                        // Recommendation content
                        var contentNum = "content-" + i;
                        var contentDivId = "#" + contentNum;
                        var $content = $("<div id='" + contentNum + "' class='d-flex content flex-column flex-xl-row'></div>");
                        $(recommendationDivId).append($content);

                        // Scrollable image list
                        if (product.imageUrlList.length > 0) {
                            var $image = $( "<div class='image d-flex komb-slider-" + (i+2) + "'></div>");
                            $(contentDivId).append($image);

                            var imageClassName = ".komb-slider-" + (i+2);
                            for (var j = 0; j < product.imageUrlList.length; j++) {
                                $(imageClassName).append("<img src='" + product.imageUrlList[j] + "' alt='Cartaygo'>");
                            }
                        }

                        var rightNum = "right-" + i;
                        var rightDivId = "#" + rightNum;
                        var $right = $("<div id='" + rightNum + "' class='right'></div>");
                        $(contentDivId).append($right);

                        $(rightDivId).append("<div class='text'><h2>" + product.productTitle + "</h2></div>");

                        var gridId = "grid-" + i;
                        var gridDivId = "#" + gridId;
                        $(rightDivId).append("<div id='" + gridId + "' class='grid'></div>");
                        for (var grid = 0; product.reviewsMention.length; grid++) {
                            console.log("grid count is " + grid);
                            if (grid >= maxMentions) {
                                break;
                            }
                            var mention = product.reviewsMention[grid];
                            console.log(mention);
                            $(gridDivId).append("<button>" + mention + "</button>");                            
                            // Only add the max number of mentions
                        }
                        $(rightDivId).append("<div class='button'><button>View at Amazon</button></div>");
                        
                        // More buttons have weird ids, just do a manual if checks to not break working html
                        if (i == 0) {
                            $(rightDivId).append("<div class='more'><button class='btn-mr' id='More'>View More</button><button class='btn-ls' id='Less'>View Less</button></div>");
                        } else if (i == 1) {
                            $(rightDivId).append("<div class='more'><button class='btn-mr' id='Moret'>View More</button><button class='btn-ls' id='Lesst'>View Less</button></div>");
                        } else if (i == 2) {
                            $(rightDivId).append("<div class='more'><button class='btn-mr' id='Moreth'>View More</button><button class='btn-ls' id='Lessth'>View Less</button></div>");
                        } else {
                            $(rightDivId).append("<div class='more'><button class='btn-mr' id='Moref'>View More</button><button class='btn-ls' id='Lessf'>View Less</button></div>");
                        }

                        // Price information
                        $(contentDivId).append("<div class='price'><div class='border'><h3 class='dollar'>$" + product.price + "</h3><p>Amazon Price</p></div><div class='border'><h3 class='rate'>" + product.productRating + "<span>/5</span></h3></div></div>");

                        // Expandable product information
                        var moreViewId;
                        if (i == 0) {
                            moreViewId = 'Show';
                        } else if (i == 1) {
                            moreViewId = 'Showt';
                        } else if (i == 2) {
                            moreViewId = 'Showth';
                        } else {
                            moreViewId = 'Showf';
                        }
                        var moreViewDivId = "#" + moreViewId;
                        $(recommendationDivId).append("<div id='" + moreViewId + "' class='more-view'></div>");

                        var moreContentNum = "more-content-" + i;
                        var moreContentDivId = "#" + moreContentNum;
                        $(moreViewDivId).append("<div id='" + moreContentNum + "' class='d-flex justify-content-between flex-column flex-xl-row'>");

                        // Reviews and Ratings
                        var ratingNum = "rating-" + i;
                        var ratingDivId = "#" + ratingNum;
                        $(moreContentDivId).append("<div id='" + ratingNum + "' class='rating'><h2>Amazon Rating</h2></div>");

                        var ratingContentNum = "rating-content-" + i;
                        var ratingContentDivId = "#" + ratingContentNum;
                        $(ratingDivId).append("<div id='" + ratingContentNum + "' class='d-flex margin'></div>");

                        var starNum = "star-" + i;
                        var starDivId = "#" + starNum;
                        $(ratingContentDivId).append("<div id='" + starNum + "' class='star></div>");

                        // Star rating round up since we do not have image for half.
                        var roundedProductScore = Math.round(product.productRating);
                        for(var score = 0; score < roundedProductScore; score++) {
                            $(starDivId).append("<img src='./assets/images/star.png' alt='Cartaygo'>");                            
                        }

                        $(ratingContentDivId).append("<div class='numb'><img src='./assets/images/fi-rr-angle-small.png' alt='Cartaygo'></div>");
                        $(ratingContentDivId).append("<p>" + product.numReviews + "</p>");
                        

                        // Add shipping info w/ Prime
                        if (product.isPrime) {
                            $(moreContentDivId).append("<div class='shipping'><h2>Shipping</h2><div><img src='./assets/images/prime.png' alt='Cartaygo'</div></div>");
                        }
                        // Brand info
                        $(moreContentDivId).append("<div class='brand'><h2>Brand</h2><div class='text'><p>" + product.manufacturer + "</p></div></div>");

                        // Product Description stuff
                        var descriptionNum = "description-" + i;
                        var descriptionDivId = "#" + descriptionNum;
                        $(moreViewDivId).append("<div class='description'><h2>Product Description</h2><p>" + product.productDescription + "</p><h2>Product Details</h2><div id='" + descriptionNum + "' class='description-details'></div></div>");

                        // Other Product details
                        if (product.ProductDimension || product.ProductDimension !== "") {
                            $(descriptionDivId).append("<div class='d-flex flex-column flex-xl-row'><h4>Product Dimensions</h4><p>" + product.ProductDimension + "</p></div>");
                        }

                        if (product.itemModel || product.itemModel !== "") {
                            $(descriptionDivId).append("<div class='d-flex flex-column flex-xl-row'><h4>Item model number</h4><p>" + product.itemModel + "</p></div>");
                        }
                        
                        if (product.HeroCategory || product.HeroCategory !== "") {
                            $(descriptionDivId).append("<div class='d-flex flex-column flex-xl-row'><h4>Department</h4><p>" + product.HeroCategory + "</p></div>");
                        }
                        
                        if (product.asin || product.asin !== "") {
                            $(descriptionDivId).append("<div class='d-flex flex-column flex-xl-row'><h4>ASIN</h4><p>" + product.asin + "</p></div>");
                        }

                        if (product.salesRank || product.salesRank !== "") {
                            $(descriptionDivId).append("<div class='d-flex flex-column flex-xl-row'><h4>Amazon Best Sellers Rank</h4><p>" + product.salesRank + "</p></div>");
                        }
                        
                    } // end of for loop

                    // If Product length is 1 that means there are no recommendations returned by the server. So only the user entered
                    // product is returned.
                    if (products.length == 1) {
                        $(".result-recommendation").html("Sorry, we could not find better recommendations for the product.");
                    }
                }
            },
            error: function(xhr, statusText) {
                $("#result-container").html("Something went wrong, please try again later.");
            }
        });
    });
});